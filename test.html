<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æˆ‘çš„ä½ç½®åœ°å›¾</title>

  <!-- Leaflet åœ°å›¾CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      padding: 16px 20px;
      background: rgba(15,23,42,.8);
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 15px;
      line-height: 1.4;
    }

    header button {
      background: #38bdf8;
      border: 0;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 600;
      cursor: pointer;
      color: #0f172a;
      font-size: 14px;
    }

    #status {
      font-size: 13px;
      color: #94a3b8;
      margin-top: 8px;
      min-height: 1.2em;
    }

    #map {
      flex: 1;
      min-height: 300px;
    }

    /* Leaflet é»˜è®¤æ˜¯æµ…è‰²å›¾æ ‡ï¼Œæ”¾åœ¨æ·±è‰²èƒŒæ™¯ä¸Šä¹ŸOK */
    .coords-box {
      position: absolute;
      z-index: 1000;
      bottom: 16px;
      left: 16px;
      background: rgba(0,0,0,.6);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 13px;
      line-height: 1.5;
      color: #fff;
      min-width: 180px;
      box-shadow: 0 30px 60px rgba(0,0,0,.8);
    }
    .coords-box .label {
      color:#94a3b8;
      font-size:12px;
    }
    .coords-box .val {
      font-weight:600;
      color:#fff;
      font-size:14px;
    }
  </style>
</head>
<body>

<header>
  <div>ğŸ“ å½“å‰ä½ç½®ç¤ºä¾‹ï¼ˆLeaflet + HTMLï¼‰</div>
  <button id="locBtn">è·å–æˆ‘çš„ä½ç½®</button>
  <div id="status">æœªå®šä½</div>
</header>

<div id="map"></div>

<div class="coords-box">
  <div class="label">çº¬åº¦</div>
  <div class="val" id="latText">--</div>
  <div class="label">ç»åº¦</div>
  <div class="val" id="lngText">--</div>
</div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<script>
  // å…ˆåˆå§‹åŒ–åœ°å›¾åœ¨ä¸€ä¸ªé»˜è®¤ä½ç½®ï¼ˆä¸œäº¬ç«™é™„è¿‘ï¼Œé˜²æ­¢ä¸€ç‰‡ç©ºç™½ï¼‰
  const map = L.map('map').setView([35.681236, 139.767125], 13);

  // è´´ä¸ŠOpenStreetMapåº•å›¾ç“¦ç‰‡
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);

  // æˆ‘ä»¬è‡ªå·±çš„ markerï¼ˆå…ˆæ”¾ä¸€ä¸ªå ä½ï¼‰
  let userMarker = null;

  const locBtn   = document.getElementById("locBtn");
  const statusEl = document.getElementById("status");
  const latText  = document.getElementById("latText");
  const lngText  = document.getElementById("lngText");

  locBtn.addEventListener("click", () => {
    if (!navigator.geolocation) {
      statusEl.textContent = "è¿™ä¸ªæµè§ˆå™¨ä¸æ”¯æŒå®šä½ã€‚";
      return;
    }

    statusEl.textContent = "å®šä½ä¸­â€¦";

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        latText.textContent = lat;
        lngText.textContent = lng;
        statusEl.textContent = "å®šä½æˆåŠŸ âœ”";

        // ç§»åŠ¨åœ°å›¾åˆ°å½“å‰ä½ç½®
        map.setView([lat, lng], 16);

        // å¦‚æœä¹‹å‰å·²ç»æœ‰markeräº†ï¼Œæ›´æ–°ä½ç½®
        if (userMarker) {
          userMarker.setLatLng([lat, lng]);
        } else {
          // åˆ›å»ºä¸€ä¸ªmarkerå¹¶åŠ åˆ°åœ°å›¾
          userMarker = L.marker([lat, lng]).addTo(map)
            .bindPopup("ä½ åœ¨è¿™é‡Œ ğŸ‘‹")
            .openPopup();
        }
      },
      (err) => {
        if (err.code === 1) {
          statusEl.textContent = "ä½ æ‹’ç»äº†å®šä½æƒé™ã€‚";
        } else if (err.code === 2) {
          statusEl.textContent = "æ— æ³•è·å–ä½ç½®ï¼ˆå¯èƒ½ä¿¡å·ä¸å¥½ï¼‰ã€‚";
        } else if (err.code === 3) {
          statusEl.textContent = "å®šä½è¶…æ—¶ã€‚";
        } else {
          statusEl.textContent = "æœªçŸ¥é”™è¯¯: " + err.message;
        }
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  });
</script>

</body>
</html>
